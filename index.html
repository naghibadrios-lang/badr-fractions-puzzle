<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù¾Ø§Ø²Ù„ Ú©Ø³Ø±Ù‡Ø§ - Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø¨Ø¯Ø±</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Vazirmatn', 'IRANSans', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa, #e4edf9);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      margin-bottom: 15px;
      color: #2c3e50;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .stats {
      margin-bottom: 15px;
      color: #2980b9;
      font-weight: bold;
      font-size: 16px;
    }

    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 10px 16px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      white-space: nowrap;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    #btn-light { background-color: #4a90e2; color: white; }
    #btn-unit { background-color: #50c878; color: white; }
    #btn-improper { background-color: #f9d71c; color: #222; }
    #btn-mixed { background-color: #e74c3c; color: white; }

    #btn-guide, #btn-reset {
      background-color: #9b59b6;
      color: white;
    }

    .timer-box {
      background: #2c3e50;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: bold;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      max-width: 600px;
      width: 100%;
    }

    .cell {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border: 2px solid #ccc;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 8px;
      text-align: center;
    }

    .fraction {
      display: inline-block;
      line-height: 1.2;
    }

    .fraction sup, .fraction sub {
      display: block;
      font-size: 16px;
      font-weight: bold;
    }

    .fraction sup {
      padding-bottom: 2px;
      border-bottom: 1px solid #333;
    }

    .mixed {
      display: inline-block;
      direction: ltr;
    }

    .cell:hover {
      transform: scale(1.05);
    }

    .cell.correct {
      animation: pulse 0.5s;
    }

    .cell.wrong {
      animation: shake 0.5s;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      75% { transform: translateX(6px); }
    }

    .guide-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .guide-content {
      background: white;
      padding: 25px;
      border-radius: 15px;
      max-width: 90%;
      width: 500px;
      direction: rtl;
      text-align: right;
    }

    .guide-content h2 {
      margin-bottom: 15px;
      color: #2c3e50;
    }

    .guide-content p {
      margin-bottom: 10px;
      line-height: 1.6;
    }

    .close-guide {
      margin-top: 15px;
      padding: 8px 16px;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .footer {
      margin-top: 20px;
      color: #7f8c8d;
      font-size: 14px;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
</head>
<body>
  <h1>Ù¾Ø§Ø²Ù„ Ø§Ù†ÙˆØ§Ø¹ Ú©Ø³Ø±Ù‡Ø§</h1>

  <div class="stats" id="bestTime">Ø¨Ù‡ØªØ±ÛŒÙ† Ø²Ù…Ø§Ù†: â€”</div>

  <div class="timer-box">Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: <span id="timer">Û±Û²Û°</span> Ø«Ø§Ù†ÛŒÙ‡</div>

  <div class="controls">
    <button id="btn-light" class="btn">Ú©Ø³Ø± Ø³Ø¨Ú© (Ú©ÙˆÚ†Ú©â€ŒØªØ± Ø§Ø² ÙˆØ§Ø­Ø¯)</button>
    <button id="btn-unit" class="btn">Ú©Ø³Ø± Ø¨Ø±Ø§Ø¨Ø± ÙˆØ§Ø­Ø¯</button>
    <button id="btn-improper" class="btn">Ú©Ø³Ø± Ø³Ù†Ú¯ÛŒÙ† (Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² ÙˆØ§Ø­Ø¯)</button>
    <button id="btn-mixed" class="btn">Ø¹Ø¯Ø¯ Ù…Ø®Ù„ÙˆØ·</button>
    <button id="btn-guide" class="btn">Ø±Ø§Ù‡Ù†Ù…Ø§</button>
    <button id="btn-reset" class="btn">Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
  </div>

  <div class="grid" id="grid"></div>

  <div class="footer">Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø¨Ø¯Ø±</div>

  <div class="guide-modal" id="guideModal">
    <div class="guide-content">
      <h2>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ</h2>
      <p>ğŸ”¹ <strong>Ú©Ø³Ø± Ø³Ø¨Ú© (Ú©ÙˆÚ†Ú©â€ŒØªØ± Ø§Ø² ÙˆØ§Ø­Ø¯)</strong>: ØµÙˆØ±Øª Ú©ÙˆÚ†Ú©â€ŒØªØ± Ø§Ø² Ù…Ø®Ø±Ø¬ Ø§Ø³Øª (Ù…Ø«Ù„ <span class="fraction"><sup>Û²</sup><sub>Ûµ</sub></span>).</p>
      <p>ğŸ”¹ <strong>Ú©Ø³Ø± Ø¨Ø±Ø§Ø¨Ø± ÙˆØ§Ø­Ø¯</strong>: ØµÙˆØ±Øª Ùˆ Ù…Ø®Ø±Ø¬ Ø¨Ø±Ø§Ø¨Ø±Ù†Ø¯ (Ù…Ø«Ù„ <span class="fraction"><sup>Û³</sup><sub>Û³</sub></span>).</p>
      <p>ğŸ”¹ <strong>Ú©Ø³Ø± Ø³Ù†Ú¯ÛŒÙ† (Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² ÙˆØ§Ø­Ø¯)</strong>: ØµÙˆØ±Øª Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø§Ø² Ù…Ø®Ø±Ø¬ Ø§Ø³Øª (Ù…Ø«Ù„ <span class="fraction"><sup>Û·</sup><sub>Û´</sub></span>).</p>
      <p>ğŸ”¹ <strong>Ø¹Ø¯Ø¯ Ù…Ø®Ù„ÙˆØ·</strong>: Ø´Ø§Ù…Ù„ Ø¹Ø¯Ø¯ ØµØ­ÛŒØ­ Ùˆ Ú©Ø³Ø± Ø§Ø³Øª (Ù…Ø«Ù„ <span class="mixed">Û± <span class="fraction"><sup>Û²</sup><sub>Û³</sub></span></span>).</p>
      <p>âœ… Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ù†ÙˆØ¹ Ú©Ø³Ø± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³ Ø±ÙˆÛŒ Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>
      <p>âŒ Ø§Ú¯Ø± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ØŒ Ø®Ø§Ù†Ù‡ Ù„Ø±Ø²Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ ØµØ¯Ø§ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡ Ù¾Ø®Ø´ Ù…ÛŒâ€ŒØ´ÙˆØ¯!</p>
      <button class="close-guide" id="closeGuide">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <!-- ØµØ¯Ø§Ù‡Ø§ (Ø¨Ù‡ ØµÙˆØ±Øª Base64 Ø¨Ø±Ø§ÛŒ Ø¹Ø¯Ù… Ù†ÛŒØ§Ø² Ø¨Ù‡ ÙØ§ÛŒÙ„ Ø®Ø§Ø±Ø¬ÛŒ) -->
  <audio id="soundCorrect" preload="auto">
    <source src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" type="audio/mpeg"/>
  </audio>
  <audio id="soundWrong" preload="auto">
    <source src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" type="audio/mpeg"/>
  </audio>

  <script>
    // ØªØ¨Ø¯ÛŒÙ„ Ø¹Ø¯Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
    function toPersianDigits(str) {
      const enDigits = '0123456789';
      const faDigits = 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹';
      return str.replace(/[0-9]/g, d => faDigits[enDigits.indexOf(d)]);
    }

    function makeFraction(numerator, denominator) {
      const num = toPersianDigits(String(numerator));
      const den = toPersianDigits(String(denominator));
      return `<span class="fraction"><sup>${num}</sup><sub>${den}</sub></span>`;
    }

    function makeMixed(whole, numerator, denominator) {
      const w = toPersianDigits(String(whole));
      const frac = makeFraction(numerator, denominator);
      return `<span class="mixed">${w} ${frac}</span>`;
    }

    const fractionData = {
      light: [[1,2], [2,3], [3,4], [1,5], [4,7], [5,9]],
      unit: [[1,1], [2,2], [3,3], [4,4], [5,5], [6,6]],
      improper: [[5,2], [7,3], [9,4], [10,6], [11,5], [8,3]],
      mixed: [[1,1,2], [2,1,3], [3,2,5], [1,3,4], [2,2,7], [4,1,6]]
    };

    const fractions = {
      light: fractionData.light.map(([n,d]) => makeFraction(n,d)),
      unit: fractionData.unit.map(([n,d]) => makeFraction(n,d)),
      improper: fractionData.improper.map(([n,d]) => makeFraction(n,d)),
      mixed: fractionData.mixed.map(([w,n,d]) => makeMixed(w,n,d))
    };

    const colors = {
      light: '#4a90e2',
      unit: '#50c878',
      improper: '#f9d71c',
      mixed: '#e74c3c'
    };

    let selectedType = null;
    let timer = 120;
    let startTime = null;
    let timerInterval = null;
    let allFractions = [];

    const grid = document.getElementById('grid');
    const timerDisplay = document.getElementById('timer');
    const bestTimeDisplay = document.getElementById('bestTime');
    const guideModal = document.getElementById('guideModal');
    const soundCorrect = document.getElementById('soundCorrect');
    const soundWrong = document.getElementById('soundWrong');

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ø²Ù…Ø§Ù†
    function loadBestTime() {
      const best = localStorage.getItem('fractionPuzzleBestTime');
      if (best) {
        bestTimeDisplay.textContent = `Ø¨Ù‡ØªØ±ÛŒÙ† Ø²Ù…Ø§Ù†: ${toPersianDigits(best)} Ø«Ø§Ù†ÛŒÙ‡`;
      } else {
        bestTimeDisplay.textContent = 'Ø¨Ù‡ØªØ±ÛŒÙ† Ø²Ù…Ø§Ù†: â€”';
      }
    }

    function prepareFractions() {
      allFractions = [];
      for (const type in fractions) {
        fractions[type].forEach(html => {
          allFractions.push({ html, type });
        });
      }
      shuffleArray(allFractions);
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function renderGrid() {
      grid.innerHTML = '';
      allFractions.forEach(item => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.innerHTML = item.html;
        cell.dataset.type = item.type;
        cell.addEventListener('click', () => handleCellClick(cell, item.type));
        grid.appendChild(cell);
      });
    }

    function playSound(type) {
      try {
        if (type === 'correct') {
          soundCorrect.currentTime = 0;
          soundCorrect.play().catch(e => console.log("ØµØ¯Ø§ Ù¾Ø®Ø´ Ù†Ø´Ø¯:", e));
        } else if (type === 'wrong') {
          soundWrong.currentTime = 0;
          soundWrong.play().catch(e => console.log("ØµØ¯Ø§ Ù¾Ø®Ø´ Ù†Ø´Ø¯:", e));
        }
      } catch (e) {
        console.warn("Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø®Ø´ ØµØ¯Ø§:", e);
      }
    }

    function handleCellClick(cell, correctType) {
      if (!selectedType) {
        alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù†ÙˆØ¹ Ú©Ø³Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!');
        return;
      }

      if (selectedType === correctType) {
        cell.style.backgroundColor = colors[selectedType];
        cell.style.borderColor = colors[selectedType];
        cell.classList.add('correct');
        playSound('correct');
        checkWin();
      } else {
        cell.classList.add('wrong');
        playSound('wrong');
        setTimeout(() => cell.classList.remove('wrong'), 500);
      }
    }

    function checkWin() {
      const allCells = document.querySelectorAll('.cell');
      const allCorrect = Array.from(allCells).every(cell => {
        const type = cell.dataset.type;
        const bgColor = getComputedStyle(cell).backgroundColor;
        const expectedColor = colors[type];
        const expectedRgb = hexToRgb(expectedColor);
        const expectedStr = `rgb(${expectedRgb.r}, ${expectedRgb.g}, ${expectedRgb.b})`;
        return bgColor === expectedStr || bgColor.startsWith(expectedStr);
      });

      if (allCorrect) {
        clearInterval(timerInterval);
        const elapsedTime = 120 - timer;
        const best = localStorage.getItem('fractionPuzzleBestTime');
        if (!best || elapsedTime < parseInt(best)) {
          localStorage.setItem('fractionPuzzleBestTime', String(elapsedTime));
          loadBestTime();
        }
        setTimeout(() => {
          alert(`ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø¯Ø± ${toPersianDigits(String(elapsedTime))} Ø«Ø§Ù†ÛŒÙ‡ ØªÙ…Ø§Ù… Ú©Ø±Ø¯ÛŒØ¯! ğŸ‰`);
        }, 300);
      }
    }

    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }

    function startTimer() {
      clearInterval(timerInterval);
      timer = 120;
      timerDisplay.textContent = toPersianDigits(String(timer));
      timerInterval = setInterval(() => {
        timer--;
        timerDisplay.textContent = toPersianDigits(String(timer));
        if (timer <= 0) {
          clearInterval(timerInterval);
          alert('Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯! ğŸ•’');
        }
      }, 1000);
    }

    function resetGame() {
      selectedType = null;
      prepareFractions();
      renderGrid();
      startTimer();
    }

    document.getElementById('btn-light').addEventListener('click', () => selectedType = 'light');
    document.getElementById('btn-unit').addEventListener('click', () => selectedType = 'unit');
    document.getElementById('btn-improper').addEventListener('click', () => selectedType = 'improper');
    document.getElementById('btn-mixed').addEventListener('click', () => selectedType = 'mixed');

    document.getElementById('btn-reset').addEventListener('click', resetGame);
    document.getElementById('btn-guide').addEventListener('click', () => guideModal.style.display = 'flex');
    document.getElementById('closeGuide').addEventListener('click', () => guideModal.style.display = 'none');

    loadBestTime();
    prepareFractions();
    renderGrid();
    startTimer();
  </script>
</body>
</html>